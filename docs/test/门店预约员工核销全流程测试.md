# 门店预约与员工核销全流程测试

围绕门店初始化、门店员工账号与角色分配、C 端登录与预约、员工接待与优惠券核销的端到端测试用例。

## 1. 测试范围

- 管理后台：总部/门店初始化、角色与账号、员工档案、C 端账号绑定
- C 端：登录、预约、我的预约
- 员工端/店长端：接待签到、工单入口、优惠券核销

## 2. 环境与前置条件

- 服务端与后台已可正常访问
- 已存在至少一个租户（或允许创建租户/门店）
- 已配置短信验证码或使用测试号（`18000000000 / 123456`）
- 具备后台管理员账号

## 3. 测试数据准备

- 总部：`Moker 总部`
- 门店：`Moker 南京旗舰店`
- 后台账号：
  - 员工账号：`emp01`（角色：`mini_employee`）
  - 店长账号：`mgr01`（角色：`mini_manager`）
- C 端用户手机号：`18000000000`
- 优惠券模板：`新客体验券`（生成核销码）

## 4. 测试用例

### TC-01 门店初始化（总部 + 门店）

**目的**：验证总部/门店基础数据可创建并在列表中展示。  
**入口**：后台 → 连锁 → 总部管理 / 门店管理

**步骤**
1. 在「总部管理」新增总部 `Moker 总部`。
2. 在「门店管理（连锁）」新增门店 `Moker 南京旗舰店`，选择总部为 `Moker 总部`。
3. 在「门店管理（业务）」新增门店 `Moker 南京旗舰店`，补充城市、营业时间、状态为启用。

**预期**
- 总部列表出现 `Moker 总部`
- 门店列表出现 `Moker 南京旗舰店`
- 门店状态为启用，信息完整可编辑

---

### TC-02 新建后台员工账号 + 角色分配

**目的**：验证后台账号创建及角色分配可用。  
**入口**：后台 → 系统管理 → 用户 / 角色

**步骤**
1. 在「角色」中新建或确认存在角色 `mini_employee`、`mini_manager`。
2. 在「用户」新建账号 `emp01`，分配角色 `mini_employee`，设置所属门店（租户）为 `Moker 南京旗舰店`。
3. 在「用户」新建账号 `mgr01`，分配角色 `mini_manager`，设置所属门店（租户）为 `Moker 南京旗舰店`。

**预期**
- 账号创建成功，列表中显示用户名、角色、租户信息
- 账号状态为启用

---

### TC-03 员工档案建立

**目的**：验证员工档案与系统用户可关联。  
**入口**：后台 → 员工档案

**步骤**
1. 新增员工档案，`userId` 填 `emp01` 的系统用户 ID。
2. 填写岗位、星级、提成规则等信息。

**预期**
- 员工档案创建成功
- 列表中显示对应 `userId`

---

### TC-04 C 端用户登录并选择门店

**目的**：验证 C 端登录与租户（门店）选择。  
**入口**：C 端 H5/小程序 → 登录页

**步骤**
1. 打开登录页，确认门店选择器可见或扫码回显门店。
2. 选择门店 `Moker 南京旗舰店`（非扫码场景）。
3. 使用手机号 `18000000000`、验证码 `123456` 登录。

**预期**
- 登录成功进入 C 端首页
- 个人中心显示当前门店信息
- 用户信息中 `tenantName` 为 `Moker 南京旗舰店`

---

### TC-05 C 端用户预约流程

**目的**：验证预约提交、确认、列表展示流程。  
**入口**：C 端 → 首页 → 预约服务

**步骤**
1. 进入「服务选择」页选择任一服务。
2. 选择门店 `Moker 南京旗舰店`，填写预约日期、时段、车辆信息与联系人。
3. 点击「提交预约」进入预约确认页。
4. 点击「确认预约」提交确认。
5. 进入「我的预约」查看列表。

**预期**
- 预约提交成功并生成预约 ID
- 预约确认成功，进入预约列表
- 列表中出现新预约，状态为待服务/待确认

---

### TC-06 C 端账号绑定为员工/店长

**目的**：验证 C 端账号与后台账号绑定后具备员工入口。  
**入口**：后台 → 用户模块 → 用户列表（C 端用户）

**步骤**
1. 在 C 端用户列表中找到 `18000000000`。
2. 点击「绑定账号」，选择后台账号 `emp01` 绑定保存。
3. 再次打开绑定弹窗，确认角色能力显示「员工：是」。

**预期**
- 绑定成功，无报错
- 角色能力展示正确（员工/店长）

---

### TC-07 员工端接待用户（签到）

**目的**：验证员工端看到预约并完成签到。  
**入口**：C 端登录页 → 选择「员工端登录」 → 今日任务

**步骤**
1. 使用同一手机号 `18000000000` 登录，选择「员工端登录」。
2. 在「今日任务」找到刚刚创建的预约记录。
3. 进入预约详情页点击「确认签到」。

**预期**
- 签到成功，提示成功信息
- 返回后预约状态更新（已到店/进行中）
- 工单生成，员工端可进入工单执行页

---

### TC-08 优惠券领取与核销

**目的**：验证优惠券领取、核销、重复核销拦截。  
**入口**：后台营销 / C 端优惠券 / 员工端核销

**步骤**
1. 后台「优惠券」创建模板 `新客体验券` 并启用。
2. C 端进入「优惠券」页面，领取该券，记下核销码。
3. 员工端进入「优惠券核销」，输入核销码并提交。
4. 再次输入同一核销码尝试核销。

**预期**
- 第一次核销返回成功，显示券名称
- 第二次核销失败，提示「该券已核销，无法重复使用」
- 后台「优惠券使用」新增一条核销记录，含核销门店与操作人

---

### TC-09 预约取消（可选）

**目的**：验证 C 端取消预约流程。  
**入口**：C 端 → 我的预约

**步骤**
1. 在「我的预约」选择可取消的预约，点击「取消」。
2. 确认弹窗后提交取消。

**预期**
- 提示「已取消预约」
- 列表状态更新为已取消

## 5. 验收标准

- 门店、员工、角色链路完整可用
- C 端登录、预约、确认、取消等主路径可用
- 员工端接待签到与优惠券核销可用，重复核销被拦截
- 后台相关记录（预约、优惠券使用）可追溯

