# 已实现功能

当前已在代码与联调中落地的功能，按端划分。

---

## 一、C 端（用户端 / H5·小程序）

### 1. 预约流程

| 功能 | 说明 |
|------|------|
| 选择服务 | 服务列表来自接口 `/app/service/list`，选择后跳转预约填写并携带 serviceId/serviceName |
| 选择门店 | 门店列表 `/app/store/list`，选择后跳转预约页并携带 storeId/storeName/storeAddress |
| 预约填写 | 门店/服务/日期/时段/车辆信息/备注/联系人；提交调用 `POST /app/appointment/my/submit`（自动创建/复用客户与车辆） |
| 预约确认 | 根据预约 id 拉取详情 `GET /app/appointment/my/info`，确认调用 `POST /app/appointment/my/confirm` |
| 我的预约列表 | `GET /app/appointment/my/list?tab=`，tab：all / pending / done / cancelled；支持查看、取消、再次预约 |
| 取消预约 | `POST /app/appointment/my/cancel`，仅待确认/待服务可取消，列表二次确认后调用并刷新 |

### 2. 个人中心

| 功能 | 说明 |
|------|------|
| 我的车辆 | 列表来自 `GET /app/vehicle/my/list`（按当前用户 customer 查车辆），入口在个人中心 |
| 联系客服 | 请求 `GET /app/base/config` 取 `service_phone`，有则拨号，无则提示“暂未配置客服电话” |
| 优惠券 / 消息 / 设置 | 入口存在；消息跳设置内通知页，设置见 set 子包 |

### 3. 登录

- 手机号验证码登录、微信登录（小程序）；用户写入 `user_info`，可选身份同步到后台并绑定角色（员工/店长）。

---

## 二、员工端

- **入口**：个人中心「员工入口」或直接访问员工子包（需已绑定且具备员工/店长权限）。
- **今日任务**：`GET /app/appointment/employee/todayList`、今日统计 `todayStats`。
- **到店签到**：预约详情 `GET /app/appointment/employee/detail`（含 customerPhone、storePhone）；签到 `POST /app/appointment/employee/signIn`，成功后跳工单执行。
- **联系客户 / 联系前台**：使用详情中的 customerPhone、storePhone 调用 `uni.makePhoneCall` 拨号。
- **工单执行**：工单详情 `GET /app/workorder/employee/detail`；完成本阶段 `POST /app/workorder/employee/finishStep`；提交质检 `POST /app/workorder/employee/finishQuality`。
- **本月统计**：`GET /app/workorder/employee/stats`（完成单数、提成、星级等，用于个人中心展示）。
- **提成明细 / 消息通知 / 账号安全**：当前为占位或 toast，未接真实接口。
- **上传施工照片 / 标记异常**：当前为 toast 占位。

---

## 三、店长端

- **入口**：个人中心「店长工作台」（需店长权限且端口为 manager）。
- **工作台**：今日统计 `GET /app/appointment/employee/todayStats`，今日预约列表 `GET /app/appointment/employee/managerTodayList`。
- **预约列表**：`GET /app/appointment/employee/managerAppointmentList?tab=`，tab：all / pending / arrived / done / cancelled。
- **查看**：跳签到页（只读查看预约详情）。
- **改派技师**：拉取技师列表 `GET /app/appointment/employee/technicianList`，选择后 `POST /app/appointment/employee/managerReassign`。
- **取消预约**：二次确认后 `POST /app/appointment/employee/managerCancel`，成功后刷新列表。
- **营销发放 / 门店设置 / 查看预约（弹窗）**：当前为 toast 或占位。

---

## 四、管理后台（Admin）

- **基础权限**：菜单、角色、用户、部门（组织机构）、租户、参数、日志等。
- **连锁**：总部管理、门店管理（含菜单初始化脚本）。
- **用户模块**：用户列表（含 C 端用户）、账号绑定（appUserId ↔ adminUserId）、绑定后角色访问与同步。
- **系统配置**：`base_sys_conf` 按租户隔离，支持 cKey（如 `service_phone`）按租户配置；App 通过 `GET /app/base/config` 获取业务配置。
- **配置化 CRUD**：通过 crud-pages 配置新增列表+表单页，无需单独写 Vue 页面。
- **预约/客户/车辆等业务菜单**：可按 menu.json 或 SQL 配置后使用对应列表页。

---

## 五、服务端接口摘要

| 模块/前缀 | 典型接口 | 说明 |
|-----------|----------|------|
| `/app/user/login/*` | phone, mini | 手机号/微信登录 |
| `/app/user/info/person` | GET | 个人信息（含 isEmployee/isManager） |
| `/app/base/config` | GET | 业务配置（如 service_phone），按租户 |
| `/app/service/list` | GET | 服务列表 |
| `/app/store/list` | GET | 门店列表 |
| `/app/appointment/my/*` | list, info, submit, confirm, cancel | C 端我的预约 |
| `/app/appointment/employee/*` | todayList, todayStats, managerTodayList, managerAppointmentList, detail, signIn, managerCancel, managerReassign, technicianList | 员工/店长预约与签到 |
| `/app/workorder/employee/*` | detail, stats, finishStep, finishQuality | 工单执行与统计 |
| `/app/vehicle/my/list` | GET | 我的车辆列表 |

---

## 六、数据与配置

- **多租户**：租户隔离（tenantId）；小程序用户可配置默认归属租户（如 `defaultTenantIdForAppUser`）。
- **系统配置**：`base_sys_conf` 唯一键 (tenantId, cKey)；全局用 tenantId=null，租户优先后回退全局。
- **客服电话**：后台在「系统配置」中维护 `service_phone`（按租户），C 端「联系客服」从 `/app/base/config` 读取并拨号。

以上为当前已实现功能概览；目标功能见 [目标功能](./目标功能.md)。
