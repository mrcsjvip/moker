# H5 端开发

基于 **uni-app x**（Vue 3 + Vite）的 H5 / 微信小程序同源项目，目录为 `h5/`。

---

## 一、技术栈与目录

- **框架**：Vue 3 + uni-app x，构建工具 Vite（`@dcloudio/vite-plugin-uni`）
- **UI**：cool-ui 等 uni_modules
- **状态/路由**：Pinia、项目内封装的 `router`、`request`（见 `h5/.cool/`）
- **运行**：见 [本地运行指南](./本地运行指南.md)

### 目录结构（简要）

```
h5/
├── .cool/                 # 封装：request、router、store、theme、utils 等
├── config/
│   └── proxy.ts           # 开发代理（接口 target、rewrite）
├── pages/
│   ├── index/             # 首页、我的（含 tabbar）
│   ├── biz/               # 业务：预约、门店、服务选择、车辆列表、优惠券等
│   ├── employee/          # 员工/店长子包：今日任务、签到、工单、店长工作台等
│   ├── user/              # 登录、编辑资料
│   ├── set/               # 设置、通知、关于
│   └── ...
├── pages.json             # 页面路由、分包、导航栏、meta（如 isAuth）
├── manifest.json          # 应用名、小程序 appid 等
├── App.uvue
├── vite.config.ts
└── package.json
```

---

## 二、代理与接口

- 开发时请求通过 Vite 代理转发到服务端，配置在 **`h5/config/proxy.ts`**。
- 将 `dev.target` 设为本地服务端地址（如 `http://127.0.0.1:8001`），可配合 `rewrite` 去掉前缀（如 `/dev` → 空）。
- 环境变量：如 `VITE_PROXY_TARGET` 可覆盖 target，真机调试时可用本机 IP。
- 请求封装在 `.cool` 中，通常带 token（登录态），接口 base 与代理前缀一致即可。

---

## 三、页面与分包

- **pages.json**：定义所有页面 path、style（导航栏）、meta（如 `isAuth`）。
- **分包**：`pages/biz`、`pages/employee` 等为子包，按需加载；员工/店长页需登录与角色校验（见 router 钩子）。
- **路由**：使用封装后的 `router.to(path)`、`router.query()` 等；跳转员工/店长页时由路由守卫校验 `hasEmployeeAccess()` / `hasManagerAccess()` 及端口（manager/user/employee）。

---

## 四、入口与角色

- **用户端**：首页、预约、我的等；从「我的」可进入员工入口（需已绑定且具备员工/店长权限）。
- **员工端**：今日任务、签到、工单执行、个人中心（本月统计）等。
- **店长端**：店长工作台、预约列表、改派/取消等；端口需为 manager（如从「店长工作台」入口进入）。

---

## 五、编译与发布

- **H5**：`pnpm run dev` / `pnpm run build`，输出为 Web 资源，端口见 `vite.config.ts`（如 9900）。
- **微信小程序**：需使用 HBuilderX 运行到微信开发者工具才能得到标准小程序包（含 app.json）；CLI 下 `dev:mp-weixin` / `build:mp-weixin` 产出为 H5 形态，不能直接导入微信开发者工具。详见 [微信小程序开发](./微信小程序开发.md)。

---

## 六、常见问题

- **Compiling 很久**：首次编译页面多，可等 1～2 分钟；异常时可清 `node_modules/.vite` 再试。
- **path argument must be of type string**：设置 `UNI_INPUT_DIR` 为当前目录或 h5 绝对路径后再执行 dev。
- **真机接口不通**：检查代理 target 是否为本机 IP（如 `VITE_PROXY_TARGET=http://192.168.x.x:8001`）并重新编译/运行。
